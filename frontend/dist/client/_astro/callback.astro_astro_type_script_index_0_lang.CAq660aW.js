import{s as a}from"./supabase.CX3PRodD.js";import"./_commonjsHelpers.gnU0ypJ3.js";async function s(){try{const{data:{user:r},error:i}=await a.auth.getUser();if(i){console.error("Error obteniendo usuario:",i),window.location.href="/?error=auth_failed";return}if(!r){console.error("No hay usuario autenticado"),window.location.href="/?error=no_user";return}const{data:e,error:o}=await a.from("users").select("*").eq("id",r.id).single();if(o&&o.code!=="PGRST116"&&console.error("Error verificando usuario:",o),!e){const{error:t}=await a.from("users").insert({id:r.id,email:r.email,nombre:r.user_metadata?.full_name||r.user_metadata?.name||r.email?.split("@")[0]||"Usuario",rol:"cliente"});t&&console.error("Error creando usuario:",t)}const n={id:r.id,email:r.email||"",rol:e?.rol||"cliente",nombre:e?.nombre||r.user_metadata?.full_name||r.user_metadata?.name||r.email?.split("@")[0]||"Usuario"};localStorage.setItem("auth_session",JSON.stringify(n)),window.location.href="/dashboard"}catch(r){console.error("Error en callback de autenticaci√≥n:",r),window.location.href="/?error=callback_failed"}}s();
