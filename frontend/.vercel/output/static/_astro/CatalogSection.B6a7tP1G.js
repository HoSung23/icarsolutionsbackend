import{j as e}from"./jsx-runtime.IyUXLQ-P.js";import{r as l,a as v}from"./index.BVaoNQnN.js";import{s as g}from"./supabase.CX3PRodD.js";import"./_commonjsHelpers.gnU0ypJ3.js";const f=l.createContext(void 0),y=({children:a})=>{const[n,o]=l.useState({marca:"",minPrice:"",maxPrice:"",combustible:"",transmision:"",estado:"disponible",tipo:""});return e.jsx(f.Provider,{value:{filters:n,setFilters:o},children:a})},j=()=>{const a=l.useContext(f);if(!a)throw new Error("useFilters must be used within a FilterProvider");return a},{useState:b,useEffect:N}=v,w=()=>{const{filters:a,setFilters:n}=j(),[o,c]=b(a),[u,x]=b([]);N(()=>{r()},[]);const r=async()=>{try{const{data:s,error:d}=await g.from("vehicles").select("marca");if(d)throw d;const p=Array.from(new Set(s?.map(m=>m.marca).filter(m=>m&&m.trim()!==""))).sort();x(p)}catch(s){console.error("Error cargando marcas:",s)}},i=(s,d)=>{const p={...o,[s]:d};c(p)},h=()=>{n(o)},t=()=>{const s={marca:"",minPrice:"",maxPrice:"",combustible:"",transmision:"",estado:"disponible",tipo:""};c(s),n(s)};return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md h-fit sticky top-4",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Filtros"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Marca"}),e.jsxs("select",{value:o.marca,onChange:s=>i("marca",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Todas las marcas"}),u.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rango de precio (QTZ)"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("input",{type:"number",placeholder:"Precio mÃ­nimo",value:o.minPrice,onChange:s=>i("minPrice",s.target.value),min:"0",step:"1000",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-xs text-gray-500 mt-1",children:"MÃ­n"})]}),e.jsxs("div",{children:[e.jsx("input",{type:"number",placeholder:"Precio mÃ¡ximo",value:o.maxPrice,onChange:s=>i("maxPrice",s.target.value),min:"0",step:"1000",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-xs text-gray-500 mt-1",children:"MÃ¡x"})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Combustible"}),e.jsxs("select",{value:o.combustible,onChange:s=>i("combustible",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"Gasolina",children:"Gasolina"}),e.jsx("option",{value:"DiÃ©sel",children:"DiÃ©sel"}),e.jsx("option",{value:"HÃ­brido",children:"HÃ­brido"}),e.jsx("option",{value:"ElÃ©ctrico",children:"ElÃ©ctrico"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"TransmisiÃ³n"}),e.jsxs("select",{value:o.transmision,onChange:s=>i("transmision",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"Manual",children:"Manual"}),e.jsx("option",{value:"AutomÃ¡tica",children:"AutomÃ¡tica"}),e.jsx("option",{value:"CVT",children:"CVT"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de VehÃ­culo"}),e.jsxs("select",{value:o.tipo,onChange:s=>i("tipo",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Todos los tipos"}),e.jsx("option",{value:"SedÃ¡n",children:"SedÃ¡n"}),e.jsx("option",{value:"SUV",children:"SUV"}),e.jsx("option",{value:"Pickup",children:"Pickup"}),e.jsx("option",{value:"Hatchback",children:"Hatchback"}),e.jsx("option",{value:"CoupÃ©",children:"CoupÃ©"}),e.jsx("option",{value:"Convertible",children:"Convertible"}),e.jsx("option",{value:"Van",children:"Van"}),e.jsx("option",{value:"CamiÃ³n",children:"CamiÃ³n"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:h,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 rounded transition",children:"Aplicar Filtros"}),e.jsx("button",{onClick:t,className:"w-full bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-2 rounded transition",children:"Limpiar Filtros"})]})]})};function C(){const[a,n]=l.useState([]),[o,c]=l.useState([]),[u,x]=l.useState(!0),{filters:r}=j();l.useEffect(()=>{i()},[]),l.useEffect(()=>{h()},[a,r]);const i=async()=>{try{const{data:t,error:s}=await g.from("vehicles").select("*").order("created_at",{ascending:!1});if(s)throw s;n(t||[])}catch(t){console.error("Error cargando vehÃ­culos:",t)}finally{x(!1)}},h=()=>{let t=a;r.marca&&(t=t.filter(s=>s.marca.toLowerCase().includes(r.marca.toLowerCase()))),r.minPrice&&(t=t.filter(s=>s.precio>=Number(r.minPrice))),r.maxPrice&&(t=t.filter(s=>s.precio<=Number(r.maxPrice))),r.combustible&&(t=t.filter(s=>s.combustible&&s.combustible.toLowerCase()===r.combustible.toLowerCase())),r.transmision&&(t=t.filter(s=>s.transmision&&s.transmision.toLowerCase()===r.transmision.toLowerCase())),r.estado&&(t=t.filter(s=>s.estado===r.estado)),r.tipo&&(t=t.filter(s=>s.tipo===r.tipo)),c(t)};return u?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"Cargando vehÃ­culos..."})}):o.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:a.length===0?"No hay vehÃ­culos disponibles":"No hay vehÃ­culos que coincidan con los filtros"})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:o.map(t=>e.jsx("a",{href:`/vehiculos/${t.id}`,className:"group",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition",children:[e.jsx("div",{className:"relative h-48 overflow-hidden bg-gray-200",children:t.imagenes&&t.imagenes.length>0?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:t.imagenes[0],alt:`${t.marca} ${t.modelo_aÃ±o}`,className:"w-full h-full object-cover group-hover:scale-105 transition"}),t.imagenes.length>1&&e.jsxs("div",{className:"absolute top-2 right-2 bg-blue-600 text-white px-2 py-1 rounded text-xs font-semibold",children:["+",t.imagenes.length-1," fotos"]})]}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gray-300",children:e.jsx("span",{className:"text-white text-6xl",children:"ðŸš—"})})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("h3",{className:"font-bold text-lg text-gray-900 group-hover:text-blue-600 transition",children:[t.marca," ",t.modelo_aÃ±o]}),e.jsxs("p",{className:"text-blue-600 font-bold text-xl mt-2",children:["QTZ ",t.precio.toLocaleString()]}),e.jsxs("div",{className:"text-xs text-gray-600 mt-3 space-y-1",children:[t.combustible&&e.jsxs("p",{children:["â›½ ",t.combustible]}),t.transmision&&e.jsxs("p",{children:["âš™ï¸ ",t.transmision]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:e.jsx("span",{className:`inline-block px-3 py-1 rounded-full text-xs font-semibold ${t.estado==="disponible"?"bg-green-100 text-green-800":t.estado==="vendido"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:t.estado==="disponible"?"Disponible":t.estado==="vendido"?"Vendido":"Reservado"})})]})]})},t.id))})}const S=()=>e.jsx(y,{children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsx(w,{})}),e.jsx("div",{className:"lg:col-span-3",children:e.jsx(C,{})})]})});export{S as CatalogSection};
