import{r as i}from"./index.BVaoNQnN.js";import{s}from"./supabase.CX3PRodD.js";const p=()=>{const[l,n]=i.useState(null),[g,m]=i.useState(!0),[d,o]=i.useState(null);return i.useEffect(()=>{(async()=>{try{const e=localStorage.getItem("auth_session");if(e){const t=JSON.parse(e),{data:{user:a}}=await s.auth.getUser();a?n(t):localStorage.removeItem("auth_session")}}catch(e){console.error("Error restaurando sesión:",e),o(e.message)}finally{m(!1)}})()},[]),{user:l,loading:g,error:d,login:async(r,e)=>{try{o(null);const{data:t,error:a}=await s.auth.signInWithPassword({email:r,password:e});if(a)throw a;if(!t.user)throw new Error("No se pudo iniciar sesión");const{data:u,error:h}=await s.from("users").select("*").eq("id",t.user.id).single();if(h)throw h;const c={id:t.user.id,email:t.user.email||"",rol:u.rol,nombre:u.nombre};return localStorage.setItem("auth_session",JSON.stringify(c)),n(c),c}catch(t){throw o(t.message||"Error al iniciar sesión"),t}},signInWithGoogle:async()=>{try{o(null);const{data:r,error:e}=await s.auth.signInWithOAuth({provider:"google",options:{redirectTo:`${window.location.origin}/auth/callback`}});if(e)throw e;return r}catch(r){throw o(r.message||"Error al iniciar sesión con Google"),r}},signInWithFacebook:async()=>{try{o(null);const{data:r,error:e}=await s.auth.signInWithOAuth({provider:"facebook",options:{redirectTo:`${window.location.origin}/auth/callback`}});if(e)throw e;return r}catch(r){throw o(r.message||"Error al iniciar sesión con Facebook"),r}},logout:async()=>{try{o(null);const{error:r}=await s.auth.signOut();if(r)throw r;localStorage.removeItem("auth_session"),localStorage.removeItem("remember_email"),localStorage.removeItem("remember_password"),localStorage.removeItem("remember_me"),n(null)}catch(r){throw o(r.message||"Error al cerrar sesión"),r}},isAuthenticated:!!l}};export{p as u};
