import{j as e}from"./jsx-runtime.IyUXLQ-P.js";import{r as n}from"./index.BVaoNQnN.js";import{s as m}from"./supabase.CX3PRodD.js";import"./_commonjsHelpers.gnU0ypJ3.js";function Q(){const[c,v]=n.useState([]),[N,h]=n.useState(!0),[s,l]=n.useState("pendiente"),[r,g]=n.useState(null),[w,o]=n.useState(!1),[p,u]=n.useState(""),[y,f]=n.useState(""),[b,j]=n.useState(!1);n.useEffect(()=>{d()},[s]);const d=async()=>{h(!0);try{let t=m.from("cotizaciones").select(`
          *,
          vehicles:vehicle_id (
            marca,
            modelo_año,
            precio
          )
        `).order("created_at",{ascending:!1});s!=="todas"&&(t=t.eq("estado",s));const{data:a,error:i}=await t;if(i)throw i;v(a||[])}catch(t){console.error("Error cargando cotizaciones:",t)}finally{h(!1)}},x=async(t,a)=>{try{const{error:i}=await m.from("cotizaciones").update({estado:a}).eq("id",t);if(i)throw i;d()}catch(i){console.error("Error actualizando estado:",i)}},k=t=>{g(t),u(`Cotización - ${t.vehicles?.marca} ${t.vehicles?.modelo_año}`),f(`Estimado/a ${t.nombre_cliente},

Gracias por su interés en nuestro vehículo:

${t.vehicles?.marca} ${t.vehicles?.modelo_año}
Precio: QTZ ${t.vehicles?.precio.toLocaleString()}

[Agrega aquí los detalles de la cotización]

Quedamos atentos a cualquier consulta.

Saludos cordiales,
iCarSolutions`),o(!0)},C=async()=>{if(r){j(!0);try{const t=`mailto:${r.email_cliente}?subject=${encodeURIComponent(p)}&body=${encodeURIComponent(y)}`;window.open(t,"_blank"),await x(r.id,"enviada"),o(!1),g(null)}catch(t){console.error("Error enviando email:",t)}finally{j(!1)}}},z=async t=>{if(confirm("¿Estás seguro de eliminar esta cotización?"))try{const{error:a}=await m.from("cotizaciones").delete().eq("id",t);if(a)throw a;d()}catch(a){console.error("Error eliminando cotización:",a)}},E=t=>({pendiente:"bg-yellow-100 text-yellow-800",enviada:"bg-green-100 text-green-800",rechazada:"bg-red-100 text-red-800"})[t]||"bg-gray-100 text-gray-800",S=t=>({pendiente:"Pendiente",enviada:"Enviada",rechazada:"Rechazada"})[t]||t;return N?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"Cargando cotizaciones..."})}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Gestión de Cotizaciones"}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs("button",{onClick:()=>l("todas"),className:`px-4 py-2 rounded-lg font-medium transition ${s==="todas"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Todas (",c.length,")"]}),e.jsx("button",{onClick:()=>l("pendiente"),className:`px-4 py-2 rounded-lg font-medium transition ${s==="pendiente"?"bg-yellow-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Pendientes"}),e.jsx("button",{onClick:()=>l("enviada"),className:`px-4 py-2 rounded-lg font-medium transition ${s==="enviada"?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Enviadas"}),e.jsx("button",{onClick:()=>l("rechazada"),className:`px-4 py-2 rounded-lg font-medium transition ${s==="rechazada"?"bg-red-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Rechazadas"})]})]}),c.length===0?e.jsx("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:e.jsxs("p",{className:"text-gray-500",children:["No hay cotizaciones ",s!=="todas"?`en estado "${s}"`:""]})}):e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fecha"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Vehículo"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cliente"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contacto"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estado"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[new Date(t.created_at).toLocaleDateString(),e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(t.created_at).toLocaleTimeString()})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[t.vehicles?.marca," ",t.vehicles?.modelo_año]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["QTZ ",t.vehicles?.precio.toLocaleString()]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.nombre_cliente})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900",children:t.telefono_cliente}),e.jsx("div",{className:"text-sm text-gray-500",children:t.email_cliente})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${E(t.estado)}`,children:S(t.estado)})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2",children:[t.estado==="pendiente"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>k(t),className:"text-blue-600 hover:text-blue-900",title:"Enviar cotización",children:e.jsx("svg",{className:"w-5 h-5 inline",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}),e.jsx("button",{onClick:()=>x(t.id,"rechazada"),className:"text-red-600 hover:text-red-900",title:"Rechazar",children:e.jsx("svg",{className:"w-5 h-5 inline",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),t.estado==="rechazada"&&e.jsx("button",{onClick:()=>x(t.id,"pendiente"),className:"text-yellow-600 hover:text-yellow-900",title:"Volver a pendiente",children:e.jsx("svg",{className:"w-5 h-5 inline",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),e.jsx("button",{onClick:()=>z(t.id),className:"text-gray-600 hover:text-gray-900",title:"Eliminar",children:e.jsx("svg",{className:"w-5 h-5 inline",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},t.id))})]})})}),w&&r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Enviar Cotización"}),e.jsx("button",{onClick:()=>o(!1),className:"text-gray-500 hover:text-gray-700",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"mb-4 bg-gray-50 p-4 rounded-lg",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Para: ",e.jsx("span",{className:"font-semibold",children:r.email_cliente})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Cliente: ",e.jsx("span",{className:"font-semibold",children:r.nombre_cliente})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Teléfono: ",e.jsx("span",{className:"font-semibold",children:r.telefono_cliente})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Asunto"}),e.jsx("input",{type:"text",value:p,onChange:t=>u(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Mensaje"}),e.jsx("textarea",{value:y,onChange:t=>f(t.target.value),rows:12,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>o(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition",children:"Cancelar"}),e.jsx("button",{onClick:C,disabled:b,className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg transition disabled:opacity-50",children:b?"Enviando...":"Abrir en Email"})]})]})})]})}export{Q as default};
