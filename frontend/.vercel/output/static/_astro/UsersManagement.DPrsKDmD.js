import{j as e}from"./jsx-runtime.IyUXLQ-P.js";import{r as o}from"./index.BVaoNQnN.js";import{s as n}from"./supabase.CX3PRodD.js";import"./_commonjsHelpers.gnU0ypJ3.js";const w=()=>{const[l,d]=o.useState([]),[h,m]=o.useState(!0),[a,c]=o.useState(""),[x,p]=o.useState("");o.useEffect(()=>{u()},[]);const u=async()=>{m(!0);try{const{data:{user:s}}=await n.auth.getUser();if(!s)throw new Error("No autenticado");const{data:r}=await n.from("users").select("rol").eq("id",s.id).single();if(p(r?.rol||""),r?.rol==="superadmin"||r?.rol==="admin"){const{data:t,error:i}=await n.from("users").select("*").order("created_at",{ascending:!1});if(i)throw i;d(t||[])}else throw new Error("No tienes permiso para acceder a esta sección")}catch(s){c(s.message)}finally{m(!1)}},g=async s=>{if(confirm("¿Eliminar este usuario? Esta acción es irreversible."))try{const{error:r}=await n.from("users").delete().eq("id",s);if(r)throw r;d(l.filter(t=>t.id!==s))}catch(r){c(r.message)}},f=async(s,r)=>{try{const{error:t}=await n.from("users").update({rol:r}).eq("id",s);if(t)throw t;d(l.map(i=>i.id===s?{...i,rol:r}:i))}catch(t){c(t.message)}};return h?e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsx("p",{className:"text-center text-gray-500",children:"Cargando usuarios..."})}):a&&a.includes("No tienes permiso")?e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsx("p",{className:"text-center text-red-600 font-semibold",children:a})}):e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Gestión de Usuarios"}),e.jsxs("p",{className:"text-gray-600 text-sm mt-1",children:["Total de usuarios: ",l.length]})]}),a&&a&&!a.includes("No tienes permiso")&&e.jsx("div",{className:"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded",children:a}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Nombre"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Email"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Rol"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Fecha Registro"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Acciones"})]})}),e.jsx("tbody",{children:l.map(s=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2",children:s.nombre}),e.jsx("td",{className:"px-4 py-2",children:s.email}),e.jsx("td",{className:"px-4 py-2",children:x==="superadmin"?e.jsxs("select",{value:s.rol,onChange:r=>f(s.id,r.target.value),className:"px-2 py-1 border border-gray-300 rounded bg-white text-sm capitalize",children:[e.jsx("option",{value:"vendedor",children:"Vendedor"}),e.jsx("option",{value:"gerente",children:"Gerente"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"superadmin",children:"SuperAdmin"})]}):e.jsx("span",{className:"capitalize font-semibold",children:s.rol})}),e.jsx("td",{className:"px-4 py-2 text-sm",children:new Date(s.created_at).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-2",children:x==="superadmin"&&s.rol!=="superadmin"&&e.jsx("button",{onClick:()=>g(s.id),className:"text-red-600 hover:text-red-800 font-semibold text-sm",children:"Eliminar"})})]},s.id))})]})}),l.length===0&&e.jsx("p",{className:"text-center text-gray-500 mt-4",children:"No hay usuarios registrados"})]})};export{w as default};
