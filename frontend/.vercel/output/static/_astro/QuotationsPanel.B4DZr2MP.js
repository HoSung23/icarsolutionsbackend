import{j as e}from"./jsx-runtime.IyUXLQ-P.js";import{r as s}from"./index.BVaoNQnN.js";import{s as c}from"./supabase.CX3PRodD.js";import"./_commonjsHelpers.gnU0ypJ3.js";const C=()=>{const[d,p]=s.useState([]),[m,x]=s.useState(!0),[h,u]=s.useState(""),[g,n]=s.useState(!1),[a,o]=s.useState({cliente_nombre:"",cliente_email:"",total:""});s.useEffect(()=>{b()},[]);const b=async()=>{x(!0);try{const{data:{user:t}}=await c.auth.getUser();if(!t)throw new Error("No autenticado");const{data:l,error:r}=await c.from("cotizaciones").select("*").eq("created_by",t.id).order("created_at",{ascending:!1});if(r)throw r;p(l||[])}catch(t){u(t.message||"Error al cargar cotizaciones")}finally{x(!1)}},f=async t=>{t.preventDefault();try{const{data:{user:l}}=await c.auth.getUser();if(!l)throw new Error("No autenticado");const{error:r}=await c.from("cotizaciones").insert({cliente_nombre:a.cliente_nombre,cliente_email:a.cliente_email,cliente_telefono:"",total:parseFloat(a.total),items:{description:"Cotización de vehículos"},created_by:l.id});if(r)throw r;o({cliente_nombre:"",cliente_email:"",total:""}),n(!1),b()}catch(l){u(l.message)}},y=t=>{const l=`
COTIZACIÓN - iCarSolutions
========================

Cliente: ${t.cliente_nombre}
Email: ${t.cliente_email}
Fecha: ${new Date(t.created_at).toLocaleDateString()}

Total: $${t.total.toLocaleString()}

---
Documento generado automáticamente
    `,r=new Blob([l],{type:"text/plain"}),j=URL.createObjectURL(r),i=document.createElement("a");i.href=j,i.download=`cotizacion-${t.id}.txt`,i.click()};return m?e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsx("p",{className:"text-center text-gray-500",children:"Cargando cotizaciones..."})}):e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Cotizaciones"}),e.jsx("button",{onClick:()=>n(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-semibold transition",children:"+ Nueva Cotización"})]}),h&&e.jsx("div",{className:"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded",children:h}),g&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-8 max-w-md w-full",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Nueva Cotización"}),e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Nombre del Cliente",value:a.cliente_nombre,onChange:t=>o({...a,cliente_nombre:t.target.value}),className:"w-full px-3 py-2 border rounded-lg",required:!0}),e.jsx("input",{type:"email",placeholder:"Email del Cliente",value:a.cliente_email,onChange:t=>o({...a,cliente_email:t.target.value}),className:"w-full px-3 py-2 border rounded-lg",required:!0}),e.jsx("input",{type:"number",placeholder:"Total",value:a.total,onChange:t=>o({...a,total:t.target.value}),className:"w-full px-3 py-2 border rounded-lg",required:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg font-semibold",children:"Crear"}),e.jsx("button",{type:"button",onClick:()=>n(!1),className:"flex-1 bg-gray-300 hover:bg-gray-400 text-gray-900 py-2 rounded-lg font-semibold",children:"Cancelar"})]})]})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Cliente"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Email"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Total"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Fecha"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Acciones"})]})}),e.jsx("tbody",{children:d.map(t=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2",children:t.cliente_nombre}),e.jsx("td",{className:"px-4 py-2",children:t.cliente_email}),e.jsxs("td",{className:"px-4 py-2",children:["$",t.total.toLocaleString()]}),e.jsx("td",{className:"px-4 py-2",children:new Date(t.created_at).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("button",{onClick:()=>y(t),className:"text-blue-600 hover:text-blue-800 font-semibold",children:"Descargar"})})]},t.id))})]})}),d.length===0&&!m&&e.jsx("p",{className:"text-center text-gray-500 mt-4",children:"No hay cotizaciones"})]})};export{C as default};
